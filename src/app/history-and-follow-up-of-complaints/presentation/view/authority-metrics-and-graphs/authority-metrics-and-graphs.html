<div class="authority-metrics" role="main" [attr.aria-label]="'METRICS.MAIN_LABEL' | translate">
  <header class="metrics-header" aria-labelledby="metrics-title">
    <h1 id="metrics-title" class="metrics-title">{{ 'METRICS.HEADER.TITLE' | translate }}</h1>
    <p class="metrics-subtitle">
      {{ 'METRICS.HEADER.SUBTITLE' | translate }}
    </p>
  </header>

  <div *ngIf="isLoading" class="loading-state" role="status" aria-live="polite">
    <p>{{ 'METRICS.STATES.LOADING' | translate }}</p>
  </div>

  <div *ngIf="errorMessage && !isLoading" class="error-state" role="alert" aria-live="assertive">
    <p>{{ errorMessage }}</p>
    <button
      (click)="loadMetricsData()"
      class="retry-button"
      [attr.aria-label]="'METRICS.STATES.RETRY' | translate"
    >
      {{ 'METRICS.STATES.RETRY' | translate }}
    </button>
  </div>

  <section *ngIf="!isLoading && !errorMessage" class="metrics-grid" [attr.aria-label]="'METRICS.METRICS_GRID.SECTION_LABEL' | translate">
    <div class="metric-card" role="group" [attr.aria-label]="'METRICS.METRICS_GRID.MONTHLY_TOTAL.ARIA_LABEL' | translate: { count: monthlyTotal }">
      <div class="metric-icon total-icon">
        <span class="icon" aria-hidden="true">üìà</span>
      </div>
      <div class="metric-content">
        <h3 class="metric-title">{{ 'METRICS.METRICS_GRID.MONTHLY_TOTAL.TITLE' | translate }}</h3>
        <p class="metric-number" [attr.aria-label]="'METRICS.METRICS_GRID.MONTHLY_TOTAL.ARIA_LABEL' | translate: { count: monthlyTotal }">
          {{ monthlyTotal }}
        </p>
      </div>
    </div>

    <div class="metric-card" role="group" [attr.aria-label]="'METRICS.METRICS_GRID.MOST_COMMON_CATEGORY.ARIA_LABEL' | translate: { category: mostCommonCategory }">
      <div class="metric-icon category-icon">
        <span class="icon" aria-hidden="true">üè∑Ô∏è</span>
      </div>
      <div class="metric-content">
        <h3 class="metric-title">{{ 'METRICS.METRICS_GRID.MOST_COMMON_CATEGORY.TITLE' | translate }}</h3>
        <p class="metric-category" [attr.aria-label]="'METRICS.METRICS_GRID.MOST_COMMON_CATEGORY.ARIA_LABEL' | translate: { category: mostCommonCategory }">
          {{ mostCommonCategory }}
        </p>
      </div>
    </div>

    <div class="metric-card" role="group" [attr.aria-label]="'METRICS.METRICS_GRID.DISTRICT_MOST_COMPLAINTS.ARIA_LABEL' | translate: { district: districtWithMostComplaints }">
      <div class="metric-icon district-icon">
        <span class="icon" aria-hidden="true">üèôÔ∏è</span>
      </div>
      <div class="metric-content">
        <h3 class="metric-title">{{ 'METRICS.METRICS_GRID.DISTRICT_MOST_COMPLAINTS.TITLE' | translate }}</h3>
        <p class="metric-district" [attr.aria-label]="'METRICS.METRICS_GRID.DISTRICT_MOST_COMPLAINTS.ARIA_LABEL' | translate: { district: districtWithMostComplaints }">
          {{ districtWithMostComplaints }}
        </p>
      </div>
    </div>
  </section>

  <div class="charts-section" *ngIf="!isLoading && !errorMessage" role="region" [attr.aria-label]="'METRICS.CHARTS.SECTION_LABEL' | translate">
    <div class="chart-card polar-area-card" role="group" [attr.aria-label]="'METRICS.CHARTS.DISTRIBUTION_BY_CATEGORY.ARIA_LABEL' | translate">
      <h3 class="chart-title">{{ 'METRICS.CHARTS.DISTRIBUTION_BY_CATEGORY.TITLE' | translate }}</h3>
      <div class="chart-wrapper">
        <p-chart
          type="polarArea"
          [data]="polarAreaData"
          [options]="polarAreaOptions"
          [style]="{'width': '100%', 'height': '400px'}"
          [attr.aria-label]="'METRICS.CHARTS.DISTRIBUTION_BY_CATEGORY.ARIA_LABEL' | translate">
        </p-chart>
      </div>
    </div>

    <div class="chart-card trends-card" role="group" [attr.aria-label]="'METRICS.CHARTS.MONTHLY_TRENDS.ARIA_LABEL' | translate">
      <h3 class="chart-title">{{ 'METRICS.CHARTS.MONTHLY_TRENDS.TITLE' | translate }}</h3>
      <div class="chart-wrapper">
        <p-chart
          type="bar"
          [data]="categoryTrendsData"
          [options]="categoryTrendsOptions"
          [style]="{'width': '100%', 'height': '400px'}"
          [attr.aria-label]="'METRICS.CHARTS.MONTHLY_TRENDS.ARIA_LABEL' | translate">
        </p-chart>
      </div>
    </div>
  </div>
</div>
