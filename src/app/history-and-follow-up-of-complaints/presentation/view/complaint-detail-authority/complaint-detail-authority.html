<div *ngIf="!complaint" class="loading" aria-live="polite" aria-busy="true">
  <p>{{ 'COMPLAINT_DETAIL.LOADING' | translate }}</p>
</div>

<div class="complaint-detail" *ngIf="complaint" aria-labelledby="complaint-title">
  <h1 class="title" id="complaint-title">{{ 'COMPLAINT_DETAIL.TITLE' | translate }}</h1>

  <section class="timeline-section" [attr.aria-label]="'COMPLAINT_DETAIL.TIMELINE.SECTION_LABEL' | translate">
    <div class="container">
      <ejs-timeline cssClass="dot-color custom-connector" orientation="Horizontal" [attr.aria-label]="'COMPLAINT_DETAIL.TIMELINE.ARIA_LABEL' | translate">
        <e-items>
          <e-item
            *ngFor="let item of orderStatus"
            [content]="item.content"
            [oppositeContent]="item.oppositeContent"
            [cssClass]="item.cssClass"
            [attr.aria-label]="item.content + ' - ' + item.oppositeContent">
          </e-item>
        </e-items>
      </ejs-timeline>
    </div>
  </section>

  <div class="complaint-info" [attr.aria-label]="'COMPLAINT_DETAIL.INFO_SECTION.LABEL' | translate">
    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.CATEGORY' | translate }}</h2>
    <p>{{ complaint.category }}</p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.DEPARTMENT' | translate }}</h2>
    <p>{{ complaint.department }}</p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.CITY' | translate }}</h2>
    <p>{{ complaint.city }}</p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.DISTRICT' | translate }}</h2>
    <p>{{ complaint.district }}</p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.LOCATION' | translate }}</h2>
    <p>{{ complaint.location }}</p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.REFERENCE_INFO' | translate }}</h2>
    <p>{{ complaint.referenceInfo }}</p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.DESCRIPTION' | translate }}</h2>
    <p>{{ complaint.description }}</p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.STATUS' | translate }}</h2>
    <p>
      <span [ngClass]="getStatusClass(complaint.status)" [attr.aria-label]="'COMPLAINT_DETAIL.INFO_SECTION.ARIA_LABELS.CURRENT_STATUS' | translate: { status: complaint.status }">
        {{ complaint.status }}
      </span>
    </p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.PRIORITY' | translate }}</h2>
    <p>
      <span [ngClass]="getPriorityClass(complaint.priority)" [attr.aria-label]="'COMPLAINT_DETAIL.INFO_SECTION.ARIA_LABELS.PRIORITY_LEVEL' | translate: { priority: complaint.priority }">
        {{ complaint.priority }}
      </span>
    </p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.EVIDENCE' | translate }}</h2>
    <div class="image-grid" [attr.aria-label]="'COMPLAINT_DETAIL.INFO_SECTION.ARIA_LABELS.EVIDENCE_IMAGES' | translate">
      <img
        *ngFor="let img of complaint.evidence; let i = index"
        [src]="img"
        [alt]="'COMPLAINT_DETAIL.INFO_SECTION.ARIA_LABELS.EVIDENCE_IMAGE_ALT' | translate: { number: i + 1 }"
      />
    </div>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.ASSIGNED_TO' | translate }}</h2>
    <p>{{ complaint.assignedTo }}</p>

    <div *ngIf="isAssigned()" class="responsible-section">
      <h3>{{ 'Assigned Responsible' | translate }}</h3>
      <div class="assigned-info">
        <p><strong>{{ 'Assigned To' | translate }}:</strong> {{ complaint?.assignedTo }}</p>
        <button
          mat-stroked-button
          color="primary"
          (click)="viewResponsibleProfile()"
          class="profile-button">
          <mat-icon>person</mat-icon>
          {{ 'View Responsible Profile' | translate }}
        </button>
      </div>
    </div>

    <div class="update-channel" [attr.aria-label]="'COMPLAINT_DETAIL.UPDATE_CHANNEL.LABEL' | translate">
      <h3>{{ 'COMPLAINT_DETAIL.UPDATE_CHANNEL.TITLE' | translate }}</h3>
      <div class="channel-message">
        <p>{{ getCurrentStatusMessage() }}</p>
        <span class="message-date" [attr.aria-label]="'COMPLAINT_DETAIL.UPDATE_CHANNEL.LAST_UPDATE' | translate">
          {{ complaint.updateDate | date: 'dd/MM/yyyy HH:mm' }}
        </span>
      </div>
    </div>
  </div>

  <div class="timeline-controls" *ngIf="complaint.timeline && complaint.timeline.length > 0" [attr.aria-label]="'COMPLAINT_DETAIL.CONTROLS.TIMELINE_CONTROLS' | translate">

    <button
      mat-stroked-button
      color="primary"
      (click)="advanceStatus()"
      [disabled]="!canAdvanceStatus()"
      [attr.aria-label]="'COMPLAINT_DETAIL.CONTROLS.ADVANCE_STATUS.ARIA_LABEL' | translate">
      {{ 'COMPLAINT_DETAIL.CONTROLS.ADVANCE_STATUS.BUTTON' | translate }}
    </button>

    <div class="decision-buttons" *ngIf="showDecisionButtons" [attr.aria-label]="'COMPLAINT_DETAIL.CONTROLS.DECISION_BUTTONS.LABEL' | translate">
      <button
        mat-stroked-button
        color="primary"
        (click)="acceptComplaint()"
        [attr.aria-label]="'COMPLAINT_DETAIL.CONTROLS.DECISION_BUTTONS.ACCEPT.ARIA_LABEL' | translate">
        {{ 'COMPLAINT_DETAIL.CONTROLS.DECISION_BUTTONS.ACCEPT.BUTTON' | translate }}
      </button>

      <button
        mat-stroked-button
        color="warn"
        (click)="rejectComplaint()"
        [attr.aria-label]="'COMPLAINT_DETAIL.CONTROLS.DECISION_BUTTONS.REJECT.ARIA_LABEL' | translate">
        {{ 'COMPLAINT_DETAIL.CONTROLS.DECISION_BUTTONS.REJECT.BUTTON' | translate }}
      </button>
    </div>

    <button
      mat-stroked-button
      color="basic"
      (click)="resetComplaint()"
      *ngIf="complaint.status !== 'Pending'"
      [attr.aria-label]="'COMPLAINT_DETAIL.CONTROLS.RESET_TIMELINE.ARIA_LABEL' | translate">
      {{ 'COMPLAINT_DETAIL.CONTROLS.RESET_TIMELINE.BUTTON' | translate }}
    </button>
  </div>

  <div *ngIf="canEditOrDelete()" class="button-group" [attr.aria-label]="'COMPLAINT_DETAIL.MANAGEMENT.LABEL' | translate">
    <button
      mat-stroked-button
      color="primary"
      (click)="editComplaint()"
      [attr.aria-label]="'COMPLAINT_DETAIL.MANAGEMENT.EDIT.ARIA_LABEL' | translate">
      {{ 'COMPLAINT_DETAIL.MANAGEMENT.EDIT.BUTTON' | translate }}
    </button>
    <button
      mat-stroked-button
      color="warn"
      (click)="deleteComplaint()"
      [attr.aria-label]="'COMPLAINT_DETAIL.MANAGEMENT.DELETE.ARIA_LABEL' | translate">
      {{ 'COMPLAINT_DETAIL.MANAGEMENT.DELETE.BUTTON' | translate }}
    </button>
  </div>
</div>
