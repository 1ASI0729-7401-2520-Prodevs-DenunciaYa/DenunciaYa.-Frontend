<div *ngIf="!complaint" class="loading" aria-live="polite" aria-busy="true">
  <p>{{ 'COMPLAINT_DETAIL.LOADING' | translate }}</p>
</div>

<div class="complaint-detail" *ngIf="complaint" aria-labelledby="complaint-title">
  <h1 class="title" id="complaint-title">{{ 'COMPLAINT_DETAIL.TITLE' | translate }}</h1>

  <section class="timeline-section" [attr.aria-label]="'COMPLAINT_DETAIL.TIMELINE.SECTION_LABEL' | translate">
    <div class="container">
      <ejs-timeline cssClass="dot-color custom-connector" orientation="Horizontal" [attr.aria-label]="'COMPLAINT_DETAIL.TIMELINE.ARIA_LABEL' | translate">
        <e-items>
          <e-item
            *ngFor="let item of orderStatus"
            [content]="item.content"
            [oppositeContent]="item.oppositeContent"
            [cssClass]="item.cssClass"
            [attr.aria-label]="item.content + ' - ' + item.oppositeContent">
          </e-item>
        </e-items>
      </ejs-timeline>
    </div>
  </section>

  <div class="complaint-info" [attr.aria-label]="'COMPLAINT_DETAIL.INFO_SECTION.LABEL' | translate">
    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.CATEGORY' | translate }}</h2>
    <p>{{ complaint.category }}</p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.DEPARTMENT' | translate }}</h2>
    <p>{{ complaint.department }}</p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.DISTRICT' | translate }}</h2>
    <p>{{ complaint.district }}</p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.LOCATION' | translate }}</h2>
    <p>{{ complaint.location }}</p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.REFERENCE_INFO' | translate }}</h2>
    <p>{{ complaint.referenceInfo }}</p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.DESCRIPTION' | translate }}</h2>
    <p>{{ complaint.description }}</p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.STATUS' | translate }}</h2>
    <p>
      <span [ngClass]="getStatusClass(complaint.status)" [attr.aria-label]="'COMPLAINT_DETAIL.INFO_SECTION.ARIA_LABELS.CURRENT_STATUS' | translate: { status: complaint.status }">
        {{ complaint.status }}
      </span>
    </p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.PRIORITY' | translate }}</h2>
    <p>
      <span [ngClass]="getPriorityClass(complaint.priority)" [attr.aria-label]="'COMPLAINT_DETAIL.INFO_SECTION.ARIA_LABELS.PRIORITY_LEVEL' | translate: { priority: complaint.priority }">
        {{ complaint.priority }}
      </span>
    </p>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.EVIDENCE' | translate }}</h2>
    <div class="image-grid" [attr.aria-label]="'COMPLAINT_DETAIL.INFO_SECTION.ARIA_LABELS.EVIDENCE_IMAGES' | translate">
      <img
        *ngFor="let img of complaint.evidence; let i = index"
        [src]="img"
        [alt]="'COMPLAINT_DETAIL.INFO_SECTION.ARIA_LABELS.EVIDENCE_IMAGE_ALT' | translate: { number: i + 1 }"
      />
    </div>

    <h2>{{ 'COMPLAINT_DETAIL.INFO_SECTION.FIELDS.ASSIGNED_TO' | translate }}</h2>

    <!-- Sección del responsable asignado -->
    <div class="assigned-section" *ngIf="isAssigned(); else notAssigned">
      <div class="assigned-info-card">
        <div class="assigned-header">
          <mat-icon class="assigned-icon">person</mat-icon>
          <div>
            <h4>{{ 'Assigned Responsible' | translate }}</h4>
            <p class="assigned-details">{{ complaint?.assignedTo }}</p>
          </div>
        </div>

        <div class="assigned-actions" *ngIf="assignedResponsible">
          <button
            mat-stroked-button
            color="primary"
            (click)="viewResponsibleProfile()"
            class="profile-button">
            <mat-icon>person</mat-icon>
            {{ 'View Responsible Profile' | translate }}
          </button>

          <div class="assigned-stats" *ngIf="assignedResponsible">
            <div class="stat">
              <span class="stat-label">{{ 'Total Cases' | translate }}:</span>
              <span class="stat-value">{{ assignedResponsible.getComplaintCount() }}</span>
            </div>
            <div class="stat">
              <span class="stat-label">{{ 'Status' | translate }}:</span>
              <span class="stat-value" [class.active]="assignedResponsible.status === 'active'"
                    [class.inactive]="assignedResponsible.status === 'inactive'">
                {{ assignedResponsible.status }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #notAssigned>
      <div class="not-assigned-card">
        <mat-icon>person_off</mat-icon>
        <p>{{ 'No responsible assigned' | translate }}</p>
      </div>
    </ng-template>

    <div class="update-channel" [attr.aria-label]="'COMPLAINT_DETAIL.UPDATE_CHANNEL.LABEL' | translate">
      <h3>{{ 'COMPLAINT_DETAIL.UPDATE_CHANNEL.TITLE' | translate }}</h3>
      <div class="channel-message">
        <p>{{ getCurrentStatusMessage() }}</p>
        <span class="message-date" [attr.aria-label]="'COMPLAINT_DETAIL.UPDATE_CHANNEL.LAST_UPDATE' | translate">
          {{ complaint.updateDate | date: 'dd/MM/yyyy HH:mm' }}
        </span>
      </div>
    </div>
  </div>

  <!-- Botón de editar SIEMPRE visible -->
  <div class="action-buttons" [attr.aria-label]="'COMPLAINT_DETAIL.MANAGEMENT.LABEL' | translate">
    <div class="button-group">
      <button
        mat-stroked-button
        color="primary"
        (click)="editComplaint()"
        [attr.aria-label]="'COMPLAINT_DETAIL.MANAGEMENT.EDIT.ARIA_LABEL' | translate">
        <mat-icon>edit</mat-icon>
        {{ 'COMPLAINT_DETAIL.MANAGEMENT.EDIT.BUTTON' | translate }}
      </button>

      <!-- Botón para asignar responsable si no está asignado -->
      <button
        *ngIf="!isAssigned()"
        mat-stroked-button
        color="accent"
        (click)="editComplaint()"
        class="assign-action-button">
        <mat-icon>person_add</mat-icon>
        {{ 'Assign Responsible' | translate }}
      </button>
    </div>

    <!-- Botones de acción adicionales (opcionales, comentados por ahora) -->
    <!--
    <div class="additional-actions">
      <button
        mat-stroked-button
        color="warn"
        (click)="deleteComplaint()"
        *ngIf="canEditOrDelete()"
        [attr.aria-label]="'COMPLAINT_DETAIL.MANAGEMENT.DELETE.ARIA_LABEL' | translate">
        <mat-icon>delete</mat-icon>
        {{ 'COMPLAINT_DETAIL.MANAGEMENT.DELETE.BUTTON' | translate }}
      </button>
    </div>
    -->
  </div>
</div>
