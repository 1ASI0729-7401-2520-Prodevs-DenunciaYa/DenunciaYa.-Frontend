<div class="container">
  <button class="back-button" mat-stroked-button color="accent" routerLink="/complaint-list">
    ‚Üê {{ 'Back to Complaints' | translate }}
  </button>

  <h2>{{ 'Edit Complaint' | translate }} #{{ complaintId }}</h2>

  <form [formGroup]="complaintForm" class="edit-form">
    <div class="row">
      <mat-form-field appearance="fill">
        <mat-label>{{ 'Category' | translate }}</mat-label>
        <input matInput formControlName="category" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>{{ 'Location' | translate }}</mat-label>
        <input matInput formControlName="location" />
      </mat-form-field>
    </div>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>{{ 'Reference' | translate }}</mat-label>
      <input matInput formControlName="referenceInfo" />
    </mat-form-field>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>{{ 'Description' | translate }}</mat-label>
      <textarea matInput formControlName="description"></textarea>
    </mat-form-field>

    <div class="evidence-section">
      <h3>{{ 'Evidence' | translate }}</h3>

      @if (complaintData?.evidence?.length > 0) {
        <div class="evidence-gallery">
          @for (img of complaintData.evidence; track img) {
            <img
              ngSrc="{{ img }}"
              alt="{{ 'Evidence' | translate }}"
              width="200"
              height="200"
              class="evidence-img"
              (click)="openImage(img)"
            />
          }
        </div>
      } @else {
        <p class="no-evidence">{{ 'No attached images' | translate }}</p>
      }
    </div>

    <div class="row">
      <mat-form-field appearance="fill">
        <mat-label>{{ 'Status' | translate }}</mat-label>
        <mat-select formControlName="status">
          @for (s of statuses; track s) {
            <mat-option [value]="s">{{ s | translate }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>{{ 'Priority' | translate }}</mat-label>
        <mat-select formControlName="priority">
          @for (p of priorities; track p) {
            <mat-option [value]="p">{{ p | translate }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>{{ 'Assign to' | translate }}</mat-label>
        <mat-select formControlName="assignedTo">
          @for (a of assignedOptions; track a) {
            <mat-option [value]="a">{{ a | translate }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>

    <mat-form-field appearance="fill" class="full-width">
      <mat-label>{{ 'Give a type of notice' | translate }}</mat-label>
      <textarea matInput formControlName="updateMessage"></textarea>
    </mat-form-field>

    <div class="button-group">
      <button mat-flat-button color="primary" (click)="saveChanges()">{{ 'Save changes' | translate }}</button>
      <button mat-stroked-button color="warn" (click)="discardChanges()">{{ 'Discard' | translate }}</button>
    </div>
  </form>

  @if (selectedImage) {
    <div class="image-modal" (click)="selectedImage = null">
      <img ngSrc="{{ selectedImage }}" width="800" height="600" alt="{{ 'Large evidence' | translate }}" />
    </div>
  }
</div>
